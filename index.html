<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroFlow 5.0 - Auth & Persistance</title>
    
    <!-- OUTILS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; transition: background-color 0.5s ease; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Input Autofill Fix for dark mode */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #0f172a inset !important;
            -webkit-text-fill-color: white !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

        // --- CONSTANTES & DATA ---
        const DB_KEY = 'neuroflow_db_v1';

        const LEVELS = [
            { lvl: 1, xp: 0, title: "Novice", reward: { type: 'theme', id: 'blue', name: 'Th√®me Oc√©an' } },
            { lvl: 2, xp: 200, title: "Apprenti", reward: { type: 'avatar', id: 'ü¶Å', name: 'Avatar Lion' } },
            { lvl: 3, xp: 500, title: "Initi√©", reward: { type: 'theme', id: 'purple', name: 'Th√®me N√©on' } },
            { lvl: 4, xp: 1000, title: "Expert", reward: { type: 'trophy', id: 'ü•â', name: 'M√©daille Bronze' } },
            { lvl: 5, xp: 2000, title: "Ma√Ætre", reward: { type: 'avatar', id: 'üöÄ', name: 'Avatar Astronaute' } },
            { lvl: 10, xp: 10000, title: "L√©gende", reward: { type: 'trophy', id: 'üèÜ', name: 'Coupe Ultime' } }
        ];

        const THEMES = {
            blue: { bg: 'from-cyan-500 to-blue-600', text: 'text-cyan-400', border: 'border-cyan-500' },
            purple: { bg: 'from-purple-500 to-pink-600', text: 'text-purple-400', border: 'border-purple-500' },
            gold: { bg: 'from-yellow-400 to-amber-600', text: 'text-amber-400', border: 'border-amber-500' },
            green: { bg: 'from-emerald-400 to-green-600', text: 'text-emerald-400', border: 'border-emerald-500' }
        };

        const SUBJECTS = [
            { id: 'maths', name: 'Maths', color: '#f43f5e', gradient: 'from-rose-500 to-red-600' },
            { id: 'phys', name: 'Physique', color: '#3b82f6', gradient: 'from-blue-500 to-indigo-600' },
            { id: 'info', name: 'Info', color: '#eab308', gradient: 'from-yellow-400 to-orange-500' },
            { id: 's2i', name: 'S2I', color: '#10b981', gradient: 'from-emerald-400 to-teal-500' },
        ];

        // --- ICONS ---
        const Icon = ({ path, className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                {path}
            </svg>
        );

        const ICONS = {
            plus: <path d="M12 5v14M5 12h14"/>,
            x: <path d="M18 6L6 18M6 6l12 12"/>,
            chart: <path d="M12 20V10M18 20V4M6 20v-4"/>,
            user: <g><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></g>,
            check: <path d="M20 6L9 17l-5-5"/>,
            lock: <g><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></g>,
            gift: <g><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></g>,
            logOut: <g><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></g>,
            lockOpen: <g><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></g>
        };

        // --- AUTH COMPONENT ---
        const AuthView = ({ onLogin }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({ username: '', password: '' });
            const [error, setError] = useState('');

            const handleSubmit = () => {
                setError('');
                if(!formData.username || !formData.password) {
                    setError("Veuillez remplir tous les champs");
                    return;
                }

                const db = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
                
                if (isLogin) {
                    // LOGIN
                    const user = db[formData.username];
                    if (user && user.password === formData.password) {
                        onLogin(formData.username, user.data);
                    } else {
                        setError("Identifiants incorrects");
                    }
                } else {
                    // REGISTER
                    if (db[formData.username]) {
                        setError("Ce pseudo est d√©j√† pris");
                        return;
                    }
                    // Cr√©ation structure initiale
                    const newUser = {
                        password: formData.password,
                        data: {
                            profile: { name: formData.username, xp: 0, avatar: "üë§", theme: "blue" },
                            courses: []
                        }
                    };
                    db[formData.username] = newUser;
                    localStorage.setItem(DB_KEY, JSON.stringify(db));
                    onLogin(formData.username, newUser.data);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-slate-900 relative overflow-hidden">
                    {/* Background Ambience */}
                    <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                        <div className="absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-blue-600/20 rounded-full blur-[100px]"></div>
                        <div className="absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-purple-600/20 rounded-full blur-[100px]"></div>
                    </div>

                    <div className="glass-panel w-full max-w-md p-8 rounded-2xl animate-slide-up relative z-10">
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-gradient-to-tr from-cyan-500 to-blue-600 rounded-xl mx-auto flex items-center justify-center mb-4 shadow-lg shadow-cyan-500/30">
                                <span className="text-3xl">üß†</span>
                            </div>
                            <h1 className="text-3xl font-bold text-white mb-2">NeuroFlow</h1>
                            <p className="text-slate-400">Optimisez votre m√©moire.</p>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-slate-400 text-sm mb-1">Pseudo</label>
                                <input 
                                    type="text" 
                                    className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-cyan-500 outline-none transition"
                                    value={formData.username}
                                    onChange={e => setFormData({...formData, username: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-slate-400 text-sm mb-1">Mot de passe</label>
                                <input 
                                    type="password" 
                                    className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-cyan-500 outline-none transition"
                                    value={formData.password}
                                    onChange={e => setFormData({...formData, password: e.target.value})}
                                />
                            </div>

                            {error && <div className="text-rose-400 text-sm text-center bg-rose-500/10 py-2 rounded-lg">{error}</div>}

                            <button 
                                onClick={handleSubmit}
                                className="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold rounded-xl shadow-lg shadow-cyan-500/20 transition transform active:scale-95"
                            >
                                {isLogin ? "Se connecter" : "Cr√©er un compte"}
                            </button>

                            <div className="text-center pt-4 border-t border-slate-700">
                                <button 
                                    onClick={() => { setIsLogin(!isLogin); setError(''); }}
                                    className="text-slate-400 hover:text-white text-sm transition"
                                >
                                    {isLogin ? "Pas encore de compte ? Inscrivez-vous" : "D√©j√† un compte ? Connectez-vous"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function NeuroFlowApp() {
            // Global State
            const [sessionUsername, setSessionUsername] = useState(null);
            
            // App Data State (only loaded when logged in)
            const [userProfile, setUserProfile] = useState(null);
            const [courses, setCourses] = useState([]);
            
            // UI State
            const [view, setView] = useState('home');
            const [selectedCourse, setSelectedCourse] = useState(null);
            const [newCourse, setNewCourse] = useState({ title: '', subject: 'maths' });

            // Persistance : Sauvegarder d√®s que userProfile ou courses changent
            useEffect(() => {
                if (sessionUsername && userProfile) {
                    const db = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
                    if (db[sessionUsername]) {
                        db[sessionUsername].data = {
                            profile: userProfile,
                            courses: courses
                        };
                        localStorage.setItem(DB_KEY, JSON.stringify(db));
                    }
                }
            }, [userProfile, courses, sessionUsername]);

            const handleLogin = (username, data) => {
                setSessionUsername(username);
                setUserProfile(data.profile);
                setCourses(data.courses);
                setView('home');
            };

            const handleLogout = () => {
                setSessionUsername(null);
                setUserProfile(null);
                setCourses([]);
                setView('login');
            };

            // Si pas connect√©, afficher Auth
            if (!sessionUsername) {
                return <AuthView onLogin={handleLogin} />;
            }

            // --- CALCULS DERIV√âS ---
            const activeTheme = THEMES[userProfile.theme] || THEMES.blue;
            const currentLevel = LEVELS.slice().reverse().find(l => userProfile.xp >= l.xp) || LEVELS[0];
            const nextLevel = LEVELS.find(l => l.lvl === currentLevel.lvl + 1);
            const progress = nextLevel ? ((userProfile.xp - currentLevel.xp) / (nextLevel.xp - currentLevel.xp)) * 100 : 100;

            // --- LOGIQUE METIER ---
            
            const handleCreateCourse = () => {
                if (!newCourse.title) return;
                const course = {
                    id: Date.now(),
                    title: newCourse.title,
                    subject: newCourse.subject,
                    created: new Date().toISOString(),
                    history: [new Date().toISOString()] // Cr√©ation = 1√®re vue
                };
                setCourses([...courses, course]);
                setNewCourse({ title: '', subject: 'maths' });
                setView('home');
                confetti({ particleCount: 50, spread: 50, origin: { y: 0.6 } });
            };

            const markAsReviewed = (course) => {
                const now = new Date().toISOString();
                
                // Update Course
                const updatedCourses = courses.map(c => {
                    if (c.id === course.id) {
                        return { ...c, history: [...c.history, now] };
                    }
                    return c;
                });
                setCourses(updatedCourses);

                // Update XP
                const xpGain = 50; 
                const newXp = userProfile.xp + xpGain;
                
                // Level Up Check
                const newLvlObj = LEVELS.slice().reverse().find(l => newXp >= l.xp);
                if (newLvlObj.lvl > currentLevel.lvl) {
                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                    alert(`NIVEAU SUP√âRIEUR ! Vous √™tes niveau ${newLvlObj.lvl}.\nR√©compense : ${newLvlObj.reward.name}`);
                } else {
                    confetti({ particleCount: 30, spread: 40, origin: { y: 0.7 }, colors: ['#38bdf8'] });
                }

                setUserProfile(prev => ({ ...prev, xp: newXp }));
            };

            const getRetentionCurves = (course) => {
                const data = [];
                const now = new Date();
                const reviewCount = course.history.length;
                const stability = 2 * Math.pow(1.8, reviewCount - 1); 
                const lastReviewDate = new Date(course.history[course.history.length - 1]);

                for (let i = 0; i <= 30; i++) {
                    const projectedDate = new Date();
                    projectedDate.setDate(now.getDate() + i);
                    
                    const daysSinceLastReview = (projectedDate - lastReviewDate) / (1000 * 60 * 60 * 24);
                    let realRetention = 100 * Math.exp(-daysSinceLastReview / stability);
                    if (daysSinceLastReview < 0) realRetention = 100;

                    const daysSinceCreation = (projectedDate - new Date(course.created)) / (1000 * 60 * 60 * 24);
                    const theoreticalRetention = 100 * Math.exp(-daysSinceCreation / 2); 

                    data.push({
                        day: `J+${i}`,
                        real: Math.round(Math.max(0, Math.min(100, realRetention))),
                        theo: Math.round(Math.max(0, Math.min(100, theoreticalRetention)))
                    });
                }
                return data;
            };

            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="bg-slate-900 border border-slate-600 p-3 rounded-lg shadow-xl text-sm">
                            <p className="font-bold text-white mb-2">{label}</p>
                            <p className="text-cyan-400">R√©tention Actuelle : {payload[0].value}%</p>
                            <p className="text-rose-400 text-xs">Sans r√©vision : {payload[1].value}%</p>
                        </div>
                    );
                }
                return null;
            };

            // --- VUES ---

            const renderHome = () => (
                <div className="max-w-6xl mx-auto p-6 space-y-8 animate-slide-up">
                    {/* Header */}
                    <div className="glass-panel rounded-2xl p-6 relative overflow-hidden flex flex-col md:flex-row items-center gap-6">
                        <div className={`absolute top-0 right-0 w-64 h-64 bg-gradient-to-br ${activeTheme.bg} opacity-20 rounded-full blur-[80px] -mr-16 -mt-16 pointer-events-none`}></div>
                        
                        <div className={`w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center text-4xl border-4 ${activeTheme.border} shadow-lg z-10`}>
                            {userProfile.avatar}
                        </div>
                        
                        <div className="flex-1 z-10 w-full text-center md:text-left">
                            <h1 className="text-3xl font-bold text-white mb-1">{userProfile.name}</h1>
                            <div className="text-slate-400 text-sm mb-3">{currentLevel.title} (Niv. {currentLevel.lvl})</div>
                            <div className="relative h-4 bg-slate-800 rounded-full overflow-hidden border border-slate-700 w-full max-w-md mx-auto md:mx-0">
                                <div className={`h-full bg-gradient-to-r ${activeTheme.bg} transition-all duration-1000`} style={{ width: `${progress}%` }}></div>
                            </div>
                        </div>

                        <div className="flex gap-3 z-10">
                            <button onClick={() => setView('profile')} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition" title="Profil">
                                <Icon path={ICONS.user} className="w-6 h-6 text-slate-300" />
                            </button>
                            <button onClick={handleLogout} className="p-3 bg-slate-800 hover:bg-red-500/20 hover:text-red-400 rounded-xl border border-slate-700 transition" title="D√©connexion">
                                <Icon path={ICONS.logOut} className="w-6 h-6" />
                            </button>
                            <button onClick={() => setView('builder')} className={`px-6 py-3 rounded-xl font-bold text-white bg-gradient-to-r ${activeTheme.bg} shadow-lg hover:opacity-90 flex items-center gap-2 transition`}>
                                <Icon path={ICONS.plus} className="w-5 h-5" /> Nouveau Cours
                            </button>
                        </div>
                    </div>

                    {/* Courses Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {courses.length === 0 ? (
                            <div className="col-span-full text-center py-20 text-slate-500 glass rounded-2xl border-dashed border-2 border-slate-700">
                                <div className="text-4xl mb-4">üìö</div>
                                <p>Aucun cours pour le moment.</p>
                                <button onClick={() => setView('builder')} className="mt-4 text-cyan-400 hover:underline">Cr√©er mon premier cours</button>
                            </div>
                        ) : courses.map(course => {
                            const sub = SUBJECTS.find(s => s.id === course.subject);
                            const isSelected = selectedCourse && selectedCourse.id === course.id;
                            const lastRev = new Date(course.history[course.history.length - 1]);
                            const isReviewedToday = lastRev.toDateString() === new Date().toDateString();

                            return (
                                <div key={course.id} className={`glass rounded-2xl p-6 relative group transition-all duration-300 ${isSelected ? 'border-cyan-500/50 bg-slate-800/80' : 'hover:border-slate-500'}`}>
                                    <div className={`absolute top-0 left-0 w-1.5 h-full bg-gradient-to-b ${sub.gradient}`}></div>
                                    
                                    <div className="pl-4 mb-4 flex justify-between items-start">
                                        <div>
                                            <span className="text-xs font-bold uppercase text-slate-400">{sub.name}</span>
                                            <h3 className="text-xl font-bold text-white mt-1">{course.title}</h3>
                                        </div>
                                        <button onClick={() => setSelectedCourse(isSelected ? null : course)} className={`text-slate-500 hover:${activeTheme.text} transition`}>
                                            <Icon path={ICONS.chart} className="w-5 h-5" />
                                        </button>
                                    </div>

                                    {isSelected && (
                                        <div className="h-48 bg-slate-900/50 rounded-lg p-2 mb-4 animate-slide-up border border-slate-700 ml-4">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <LineChart data={getRetentionCurves(course)}>
                                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                                    <XAxis hide />
                                                    <YAxis hide domain={[0, 100]} />
                                                    <Tooltip content={<CustomTooltip />} />
                                                    <Line type="monotone" dataKey="real" stroke="#22d3ee" strokeWidth={3} dot={false} />
                                                    <Line type="monotone" dataKey="theo" stroke="#ef4444" strokeWidth={2} dot={false} strokeDasharray="5 5" />
                                                </LineChart>
                                            </ResponsiveContainer>
                                            <div className="flex justify-center gap-4 text-xs text-slate-500 mt-2">
                                                <span className="flex items-center gap-1"><div className="w-2 h-2 bg-cyan-400 rounded-full"></div> R√©elle</span>
                                                <span className="flex items-center gap-1"><div className="w-2 h-2 bg-rose-500 rounded-full"></div> Th√©orique</span>
                                            </div>
                                        </div>
                                    )}

                                    <div className="pl-4">
                                        {isReviewedToday ? (
                                            <div className="w-full py-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-400 font-bold flex items-center justify-center gap-2 cursor-default">
                                                <Icon path={ICONS.check} className="w-5 h-5" /> R√©vis√© aujourd'hui
                                            </div>
                                        ) : (
                                            <button 
                                                onClick={() => markAsReviewed(course)}
                                                className={`w-full py-3 rounded-xl font-bold text-white bg-gradient-to-r ${activeTheme.bg} shadow-lg hover:opacity-90 flex items-center justify-center gap-2 transition active:scale-95`}
                                            >
                                                <Icon path={ICONS.check} className="w-5 h-5" /> J'ai r√©vis√© ce cours
                                            </button>
                                        )}
                                        <p className="text-center text-xs text-slate-500 mt-2">
                                            Derni√®re: {new Date(course.history[course.history.length-1]).toLocaleDateString()}
                                        </p>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );

            const renderBuilder = () => (
                <div className="fixed inset-0 bg-slate-900/95 z-50 flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-lg rounded-2xl border border-slate-700 shadow-2xl p-6 animate-slide-up">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-white">Ajouter un Cours</h2>
                            <button onClick={() => setView('home')} className="text-slate-400 hover:text-white"><Icon path={ICONS.x} className="w-6 h-6"/></button>
                        </div>
                        <div className="space-y-6">
                            <div>
                                <label className="block text-slate-400 text-sm mb-2">Titre du cours</label>
                                <input type="text" className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 outline-none" placeholder="Ex: Thermodynamique" value={newCourse.title} onChange={e => setNewCourse({...newCourse, title: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-slate-400 text-sm mb-2">Mati√®re</label>
                                <div className="flex gap-2">
                                    {SUBJECTS.map(s => (
                                        <button key={s.id} onClick={() => setNewCourse({...newCourse, subject: s.id})} className={`w-10 h-10 rounded-full border-2 transition flex items-center justify-center ${newCourse.subject === s.id ? 'border-white scale-110' : 'border-transparent opacity-50'}`} style={{ backgroundColor: s.color }} title={s.name} />
                                    ))}
                                </div>
                            </div>
                            <button onClick={handleCreateCourse} className={`w-full py-3 rounded-xl font-bold text-white bg-gradient-to-r ${activeTheme.bg} hover:opacity-90 transition`}>Cr√©er le cours</button>
                        </div>
                    </div>
                </div>
            );

            const renderProfile = () => (
                <div className="fixed inset-0 bg-slate-900/95 z-50 flex items-center justify-center p-4">
                    <div className="bg-slate-800 w-full max-w-2xl rounded-2xl border border-slate-700 shadow-2xl flex flex-col max-h-[90vh] animate-slide-up">
                        <div className="p-6 border-b border-slate-700 flex justify-between items-center">
                            <h2 className="text-2xl font-bold text-white">Personnalisation</h2>
                            <button onClick={() => setView('home')} className="text-slate-400 hover:text-white"><Icon path={ICONS.x} className="w-6 h-6"/></button>
                        </div>
                        <div className="p-6 overflow-y-auto custom-scrollbar space-y-8">
                            {/* Avatars */}
                            <div>
                                <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2"><Icon path={ICONS.user} className="w-5 h-5 text-cyan-400"/> Avatars</h3>
                                <div className="grid grid-cols-4 sm:grid-cols-6 gap-3">
                                    {['üë®‚Äçüéì', 'üë©‚Äçüéì', 'üß†', 'ü¶Å', 'üöÄ', 'üëë'].map((emoji, i) => {
                                        const locked = i > 1 && currentLevel.lvl < (i + 1); 
                                        return (
                                            <button key={i} disabled={locked} onClick={() => setUserProfile({...userProfile, avatar: emoji})} className={`aspect-square rounded-xl flex items-center justify-center text-2xl border-2 transition relative ${userProfile.avatar === emoji ? `border-${activeTheme.border.split('-')[1]}-500 bg-slate-700` : 'border-slate-700 bg-slate-900'} ${locked ? 'opacity-50 cursor-not-allowed' : 'hover:border-slate-500'}`}>
                                                {locked ? <Icon path={ICONS.lock} className="w-5 h-5 text-slate-500"/> : emoji}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                            {/* Th√®mes */}
                            <div>
                                <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2"><Icon path={ICONS.gift} className="w-5 h-5 text-purple-400"/> Th√®mes</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {Object.entries(THEMES).map(([key, t]) => {
                                        const levelObj = LEVELS.find(l => l.reward.type === 'theme' && l.reward.id === key);
                                        const requiredLvl = levelObj ? levelObj.lvl : 1;
                                        const locked = currentLevel.lvl < requiredLvl;
                                        return (
                                            <button key={key} disabled={locked} onClick={() => setUserProfile({...userProfile, theme: key})} className={`p-4 rounded-xl border-2 flex items-center justify-between transition ${userProfile.theme === key ? `border-${t.border.split('-')[1]}-500 bg-slate-800` : 'border-slate-700 bg-slate-900'} ${locked ? 'opacity-50 cursor-not-allowed' : 'hover:bg-slate-800'}`}>
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-8 h-8 rounded-full bg-gradient-to-br ${t.bg}`}></div>
                                                    <div className="text-left"><div className="font-bold text-white capitalize">{key}</div><div className="text-xs text-slate-400">{locked ? `Niveau ${requiredLvl}` : 'D√©bloqu√©'}</div></div>
                                                </div>
                                                {locked ? <Icon path={ICONS.lock} className="w-5 h-5 text-slate-500"/> : userProfile.theme === key && <div className="w-3 h-3 rounded-full bg-green-500"></div>}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen">
                    {view === 'home' && renderHome()}
                    {view === 'builder' && renderBuilder()}
                    {view === 'profile' && renderProfile()}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NeuroFlowApp />);
    </script>
</body>
</html>
